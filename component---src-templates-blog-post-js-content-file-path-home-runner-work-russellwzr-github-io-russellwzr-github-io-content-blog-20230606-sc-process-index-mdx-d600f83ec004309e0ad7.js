"use strict";(self.webpackChunkrussellwzr_blog=self.webpackChunkrussellwzr_blog||[]).push([[528],{39626:function(n,a,s){s.d(a,{ah:function(){return l}});var t=s(4942),p=s(67294);function e(n,a){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable}))),s.push.apply(s,t)}return s}function o(n){for(var a=1;a<arguments.length;a++){var s=null!=arguments[a]?arguments[a]:{};a%2?e(Object(s),!0).forEach((function(a){(0,t.Z)(n,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):e(Object(s)).forEach((function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))}))}return n}var c=p.createContext({});function l(n){var a=p.useContext(c);return p.useMemo((function(){return"function"==typeof n?n(a):o(o({},a),n)}),[a,n])}},14072:function(n,a,s){s.r(a),s.d(a,{Head:function(){return u},default:function(){return i}});var t=s(39626),p=s(67294);function e(n){var a=Object.assign({p:"p",a:"a",h2:"h2",div:"div",h3:"h3",strong:"strong",h4:"h4"},(0,t.ah)(),n.components);return p.createElement(p.Fragment,null,p.createElement(a.p,null,"本文是对 ",p.createElement(a.a,{href:"https://medium.com/styled-components/how-styled-components-works-618a69970421"},"How styled-components works: A deep dive under the hood ")," 的梳理与总结"),"\n",p.createElement(a.h2,null,"语法解析"),"\n",p.createElement(a.p,null,"以创建一个简单的样式化的 button 为例，其代码为："),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Button <span class="token operator">=</span> styled<span class="token punctuation">.</span>button<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n  color: coral;\n  padding: 0.25rem 1rem;\n  border: solid 2px coral;\n  border-radius: 3px;\n  margin: 0.5rem;\n  font-size: 1rem;\n</span><span class="token template-punctuation string">`</span></span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"其中 styled.button 其实是 styled(‘button’) 的一个语法糖，实际调用情况为："),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Button <span class="token operator">=</span> <span class="token function">styled</span><span class="token punctuation">(</span><span class="token string">\'button\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n  <span class="token string">\'color: coral;\'</span> <span class="token operator">+</span>\n    <span class="token string">\'padding: 0.25rem 1rem;\'</span> <span class="token operator">+</span>\n    <span class="token string">\'border: solid 2px coral;\'</span> <span class="token operator">+</span>\n    <span class="token string">\'border-radius: 3px;\'</span> <span class="token operator">+</span>\n    <span class="token string">\'margin: 0.5rem;\'</span> <span class="token operator">+</span>\n    <span class="token string">\'font-size: 1rem;\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"从这里可以看出 styled 其实是一个组件工厂函数，其会根据传入的原组件以及相关参数，创建一个新的用于后续样式化的组件。"),"\n",p.createElement(a.h2,null,"一个极简的 styled 实现"),"\n",p.createElement(a.p,null,"这里为了实现方便，采用的是将解析之后的样式直接作为内联样式插入组件。"),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">myStyled</span> <span class="token operator">=</span>\n  <span class="token punctuation">(</span><span class="token parameter">TargetComponent</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n  <span class="token punctuation">(</span><span class="token parameter">strs<span class="token punctuation">,</span> <span class="token operator">...</span>exprs</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n    <span class="token keyword">class</span> <span class="token class-name">extends</span> React<span class="token punctuation">.</span>Component <span class="token punctuation">{</span>\n      <span class="token function">interpolateStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> style <span class="token operator">=</span> exprs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> expr<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> isFunc <span class="token operator">=</span> <span class="token keyword">typeof</span> expr <span class="token operator">===</span> <span class="token string">\'function\'</span>\n          <span class="token keyword">const</span> value <span class="token operator">=</span> isFunc <span class="token operator">?</span> <span class="token function">expr</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token operator">:</span> expr\n\n          <span class="token keyword">return</span> result <span class="token operator">+</span> value <span class="token operator">+</span> strs<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> strs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'style\'</span><span class="token punctuation">,</span> style<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">interpolateStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">interpolateStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token operator">&lt;</span>TargetComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>element <span class="token operator">=</span> element<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> primaryColor <span class="token operator">=</span> <span class="token string">\'coral\'</span>\n\n<span class="token keyword">const</span> Button <span class="token operator">=</span> <span class="token function">myStyled</span><span class="token punctuation">(</span><span class="token string">\'button\'</span><span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n  background: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> primary <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>primary <span class="token operator">?</span> primaryColor <span class="token operator">:</span> <span class="token string">\'white\'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;\n  color: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> primary <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>primary <span class="token operator">?</span> <span class="token string">\'white\'</span> <span class="token operator">:</span> primaryColor<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;\n  padding: 0.25rem 1rem;\n  border: solid 2px </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>primaryColor<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;\n  border-radius: 3px;\n  margin: 0.5rem;\n  font-size: 1rem;\n</span><span class="token template-punctuation string">`</span></span></code></pre></div>'}}),"\n",p.createElement(a.h2,null,"Styled-components 工作流程"),"\n",p.createElement(a.h3,null,"Step 1：引入 styled-components"),"\n",p.createElement(a.p,null,"当第一次导入 styled-components 库时，它会创建一个内部计数器变量来记录通过样式化工厂创建的所有组件的个数，用于后续的哈希编码。"),"\n",p.createElement(a.h3,null,"Step 2：调用 styled 工厂函数"),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Button <span class="token operator">=</span> styled<span class="token punctuation">.</span>button<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n  font-size: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> sizeValue <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> sizeValue <span class="token operator">+</span> <span class="token string">\'px\'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;\n  color: coral;\n  padding: 0.25rem 1rem;\n  border: solid 2px coral;\n  border-radius: 3px;\n  margin: 0.5rem;\n  &amp;:hover {\n    background-color: bisque;\n  }\n</span><span class="token template-punctuation string">`</span></span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"当 styled-components 创建新组件时，它会为新组件创建一个内部标识符 componentId："),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// the result is sc-bdVaJa</span>\ncounter<span class="token operator">++</span>\n<span class="token keyword">const</span> componentId <span class="token operator">=</span> <span class="token string">\'sc-\'</span> <span class="token operator">+</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token string">\'sc\'</span> <span class="token operator">+</span> counter<span class="token punctuation">)</span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"组件标识符创建完毕后，styled-components 就会将新的 style 元素插入到页面的 head 中（如果它是第一个组件并且该元素尚未插入）并添加带有 componentId 的特殊注释标记："),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>style data<span class="token operator">-</span>styled<span class="token operator">-</span>components<span class="token operator">></span><span class="token comment">/* sc-component-id: sc-bdVaJa */</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"为组件设置相关静态字段："),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">StyledComponent<span class="token punctuation">.</span>componentId <span class="token operator">=</span> componentId\nStyledComponent<span class="token punctuation">.</span>target <span class="token operator">=</span> TargetComponent</code></pre></div>'}}),"\n",p.createElement(a.p,null,"通过 styled 函数创建的组件继承自",p.createElement(a.strong,null,"BaseStyledComponent"),"，其实现了多个生命周期方法，用于支持 styled-components 的工作流程。"),"\n",p.createElement(a.h3,null,"Step 3：componentWillMount()"),"\n",p.createElement(a.p,null,"该生命周期主要负责一些样式解析与插入工作："),"\n",p.createElement(a.h4,null,"3-1 解析组件样式"),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> evaluatedStyles <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">font-size: 24px;\ncolor: coral;\npadding: 0.25rem 1rem;\nborder: solid 2px coral;\nborder-radius: 3px;\nmargin: 0.5rem;\n&amp;:hover {\n  background-color: bisque;\n}</span><span class="token template-punctuation string">`</span></span></code></pre></div>'}}),"\n",p.createElement(a.h4,null,"3-2 生成 CSS 类名"),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> className <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>componentId <span class="token operator">+</span> evaluatedStyles<span class="token punctuation">)</span> <span class="token comment">//jsZVzX</span>\n\nStyledComponent<span class="token punctuation">.</span>generatedClassName <span class="token operator">=</span> className</code></pre></div>'}}),"\n",p.createElement(a.h4,null,"3-3 CSS 预处理"),"\n",p.createElement(a.p,null,"使用 stylis CSS 预处理器生成有效的 CSS 字符串，用于后续插入："),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> selector <span class="token operator">=</span> <span class="token string">\'.\'</span> <span class="token operator">+</span> className<span class="token punctuation">;</span>\n<span class="token keyword">const</span> cssStr <span class="token operator">=</span> <span class="token function">stylis</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> evaluatedStyles<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// result</span>\n<span class="token punctuation">.</span>jsZVzX <span class="token punctuation">{</span>\n  font<span class="token operator">-</span>size<span class="token operator">:</span> 24px<span class="token punctuation">;</span>\n  <span class="token literal-property property">color</span><span class="token operator">:</span> coral<span class="token punctuation">;</span>\n  <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>25rem 1rem<span class="token punctuation">;</span>\n  <span class="token literal-property property">border</span><span class="token operator">:</span> solid 2px coral<span class="token punctuation">;</span>\n  border<span class="token operator">-</span>radius<span class="token operator">:</span> 3px<span class="token punctuation">;</span>\n  <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>5rem<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token punctuation">.</span>jsZVzX<span class="token operator">:</span>hover<span class="token punctuation">{</span>\n  background<span class="token operator">-</span>color<span class="token operator">:</span> bisque<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",p.createElement(a.h4,null,"3-4 将 CSS 字符串插入 HTML 页面的 style 标签中"),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>style data<span class="token operator">-</span>styled<span class="token operator">-</span>components<span class="token operator">></span>\n  <span class="token comment">/* sc-component-id: sc-bdVaJa */</span>\n  <span class="token punctuation">.</span>sc<span class="token operator">-</span>bdVaJa <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">.</span>jsZVzX<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span>24px<span class="token punctuation">;</span>color<span class="token operator">:</span>coral<span class="token punctuation">;</span> <span class="token operator">...</span> <span class="token punctuation">}</span>\n  <span class="token punctuation">.</span>jsZVzX<span class="token operator">:</span>hover<span class="token punctuation">{</span>background<span class="token operator">-</span>color<span class="token operator">:</span>bisque<span class="token punctuation">;</span><span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span></code></pre></div>'}}),"\n",p.createElement(a.h3,null,"Step 4：render()"),"\n",p.createElement(a.p,null,"现在 CSS 的解析与插入已经完成，styled-components 只需要创建一个具有对应类名的元素："),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> TargetComponent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>target <span class="token comment">// In our case just \'button\' string.</span>\n<span class="token keyword">const</span> componentId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>componentId\n<span class="token keyword">const</span> generatedClassName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>generatedClassName\n\n<span class="token keyword">return</span> <span class="token punctuation">(</span>\n  <span class="token operator">&lt;</span>TargetComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>className <span class="token operator">+</span> <span class="token string">\' \'</span> <span class="token operator">+</span> componentId <span class="token operator">+</span> <span class="token string">\' \'</span> <span class="token operator">+</span> generatedClassName<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n<span class="token punctuation">)</span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"最后渲染后的 HTML 元素为："),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sc-bdVaJa jsZVzX"</span><span class="token operator">></span><span class="token constant">I</span>\'m a button<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span></code></pre></div>'}}),"\n",p.createElement(a.h3,null,"Step 5：componentWillReceiveProps()"),"\n",p.createElement(a.p,null,"用户的交互可能会改变组件的参数，为此，styled-component 的样式也要随之改变。"),"\n",p.createElement(a.p,null,"该部分以这个简单案例进行讲解（每点击一次，参数 sizeValue 的值加一）："),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> sizeValue <span class="token operator">=</span> <span class="token number">24</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">updateButton</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>Button sizeValue<span class="token operator">=</span><span class="token punctuation">{</span>sizeValue<span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span>updateButton<span class="token punctuation">}</span><span class="token operator">></span>\n      Font size is <span class="token punctuation">{</span>sizeValue<span class="token punctuation">}</span>px\n    <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span><span class="token punctuation">,</span>\n    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'root\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span>\n  sizeValue<span class="token operator">++</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">updateButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"每次点击按钮时，都会调用 componentWillReceiveProps() 并增加 sizeValue 属性，并执行与 componentWillMount() 相同的操作，点击几次后，HTML 的 style 标签的内容如下："),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>style data<span class="token operator">-</span>styled<span class="token operator">-</span>components<span class="token operator">></span>\n  <span class="token comment">/* sc-component-id: sc-bdVaJa */</span>\n  <span class="token punctuation">.</span>sc<span class="token operator">-</span>bdVaJa <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token punctuation">.</span>jsZVzX<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span>24px<span class="token punctuation">;</span>color<span class="token operator">:</span>coral<span class="token punctuation">;</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token punctuation">.</span>jsZVzX<span class="token operator">:</span>hover<span class="token punctuation">{</span>background<span class="token operator">-</span>color<span class="token operator">:</span>bisque<span class="token punctuation">;</span><span class="token punctuation">}</span>\n  <span class="token punctuation">.</span>kkRXUB<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span>25px<span class="token punctuation">;</span>color<span class="token operator">:</span>coral<span class="token punctuation">;</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token punctuation">.</span>kkRXUB<span class="token operator">:</span>hover<span class="token punctuation">{</span>background<span class="token operator">-</span>color<span class="token operator">:</span>bisque<span class="token punctuation">;</span><span class="token punctuation">}</span>\n  <span class="token punctuation">.</span>jvOYbh<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span>26px<span class="token punctuation">;</span>color<span class="token operator">:</span>coral<span class="token punctuation">;</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token punctuation">.</span>jvOYbh<span class="token operator">:</span>hover<span class="token punctuation">{</span>background<span class="token operator">-</span>color<span class="token operator">:</span>bisque<span class="token punctuation">;</span><span class="token punctuation">}</span>\n  <span class="token punctuation">.</span>ljDvEV<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span>27px<span class="token punctuation">;</span>color<span class="token operator">:</span>coral<span class="token punctuation">;</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token punctuation">.</span>ljDvEV<span class="token operator">:</span>hover<span class="token punctuation">{</span>background<span class="token operator">-</span>color<span class="token operator">:</span>bisque<span class="token punctuation">;</span><span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"由于删除 CSS 类会增加性能开销，目前 style 标签中每个 CSS 类的唯一区别只有 font-size 属性，未使用的 CSS 类不会被删除，因此随着点击次数的不断增加，style 标签的内容也会不断膨胀。为此，可以使用 attrs 方法进行优化："),"\n",p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Button <span class="token operator">=</span> styled<span class="token punctuation">.</span>button<span class="token punctuation">.</span><span class="token function">attrs</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token function-variable function">style</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> sizeValue <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">fontSize</span><span class="token operator">:</span> sizeValue <span class="token operator">+</span> <span class="token string">\'px\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n  color: coral;\n  padding: 0.25rem 1rem;\n  border: solid 2px coral;\n  border-radius: 3px;\n  margin: 0.5rem;\n  &amp;:hover {\n    background-color: bisque;\n  }\n</span><span class="token template-punctuation string">`</span></span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"当然，并不是所有的动态样式都应该采取这种方式，该场景主要为取值范围起伏较大的属性，比如词云的字体大小，从服务器加载的不同颜色的标签列表等。如果只有几个简单的取值，比如 Button 组件的 primary, secondary, success, warning 等，则感觉就没多大必要了。"),"\n",p.createElement(a.p,null,"最终，使用 attrs 方法点击多次后的结果如下图所示，避免了 style 标签内容的无限膨胀。"),"\n",p.createElement(a.p,null,p.createElement(a.div,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/f2f7a162a7b332dd91222608bccbf545/5cbb4/final_style.jpg"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 27.21518987341772%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAEDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHerCRL/8QAFhABAQEAAAAAAAAAAAAAAAAAABFB/9oACAEBAAEFAo1//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFxABAQEBAAAAAAAAAAAAAAAAAQARIf/aAAgBAQABPyHB2YN//9oADAMBAAIAAwAAABB0L//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EFf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAYEAEAAwEAAAAAAAAAAAAAAAABABEhof/aAAgBAQABPxCyg2O0pLDQ7P/Z\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="final style"\n        title="final style"\n        src="/static/f2f7a162a7b332dd91222608bccbf545/828fb/final_style.jpg"\n        srcset="/static/f2f7a162a7b332dd91222608bccbf545/ff44c/final_style.jpg 158w,\n/static/f2f7a162a7b332dd91222608bccbf545/a6688/final_style.jpg 315w,\n/static/f2f7a162a7b332dd91222608bccbf545/828fb/final_style.jpg 630w,\n/static/f2f7a162a7b332dd91222608bccbf545/0ede0/final_style.jpg 945w,\n/static/f2f7a162a7b332dd91222608bccbf545/3ac88/final_style.jpg 1260w,\n/static/f2f7a162a7b332dd91222608bccbf545/5cbb4/final_style.jpg 1651w"\n        sizes="(max-width: 630px) 100vw, 630px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}})))}var o=function(n){void 0===n&&(n={});var a=Object.assign({},(0,t.ah)(),n.components).wrapper;return a?p.createElement(a,n,p.createElement(e,n)):e(n)},c=s(85638),l=s(31821),r=function(n){var a=n.data.mdx,s=n.children;return p.createElement(c.Ar,null,p.createElement("article",{className:"mt-12 prose max-w-none dark:prose-invert",itemScope:!0,itemType:"http://schema.org/Article"},p.createElement("header",null,p.createElement("h1",{itemProp:"headline"},a.frontmatter.title),p.createElement("p",null,a.frontmatter.date)),s))},u=function(n){var a=n.data.mdx;return p.createElement(l.pQ,{title:a.frontmatter.title,description:a.frontmatter.description||a.excerpt})};function i(n){return p.createElement(r,n,p.createElement(o,n))}},4942:function(n,a,s){function t(n,a,s){return a in n?Object.defineProperty(n,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[a]=s,n}s.d(a,{Z:function(){return t}})}}]);
//# sourceMappingURL=component---src-templates-blog-post-js-content-file-path-home-runner-work-russellwzr-github-io-russellwzr-github-io-content-blog-20230606-sc-process-index-mdx-d600f83ec004309e0ad7.js.map